
GRAPHASM_BSS SEGMENT WORD PUBLIC

EXTRN GRAPH_GRAPHGETMEMPTR:DWORD
EXTRN GRAPH_GRAPHFREEMEMPTR:DWORD
EXTRN SYSTEMP_EXITPROC:DWORD

save00		DD	?
save3f		DD	?
saveEXIT	DD	?

GRAPHASM_BSS ENDS
    
GRAPHASM_TEXT SEGMENT BYTE PUBLIC
GRAPHASM_TEXT ENDS

DGROUP GROUP GRAPHASM_BSS

GRAPHASM_TEXT SEGMENT

    ASSUME CS:GRAPHASM_TEXT, DS:DGROUP

saveDS	DW	0
saveRET	DD	0

PUBLIC GRAPH_REDGETMEM

GRAPH_REDGETMEM PROC FAR
	pop WORD PTR cs:saveRET
	pop WORD PTR cs:saveRET+2
	mov cs:saveDS, ds
	mov ax, DGROUP
	mov ds, ax
	call DWORD PTR GRAPH_GRAPHGETMEMPTR
	mov ds, cs:saveDS
	jmp DWORD PTR cs:saveRET
GRAPH_REDGETMEM ENDP

PUBLIC GRAPH_REDFREEMEM
    
GRAPH_REDFREEMEM PROC FAR
	pop WORD PTR cs:saveRET
	pop WORD PTR cs:saveRET+2
	mov cs:saveDS, ds
	mov ax, DGROUP
	mov ds, ax
	call DWORD PTR GRAPH_GRAPHFREEMEMPTR
	mov ds, cs:saveDS
	jmp DWORD PTR cs:saveRET
GRAPH_REDFREEMEM ENDP

PUBLIC GRAPH_SAVEVECTS

GRAPH_SAVEVECTS PROC FAR
	mov ax, 3500h
	int 21h
	mov WORD PTR save00, bx
	mov WORD PTR save00+2, es
	mov ax, 353Fh
	int 21h
	mov WORD PTR save3F, bx
	mov WORD PTR save3F+2, es
	mov ax, WORD PTR SYSTEMP_EXITPROC
	mov WORD PTR saveEXIT, ax
	mov ax, WORD PTR SYSTEMP_EXITPROC+2
	mov WORD PTR saveEXIT+2, ax
	mov WORD PTR SYSTEMP_EXITPROC, OFFSET GRAPH_RESTVECTS
	mov WORD PTR SYSTEMP_EXITPROC+2, cs
	ret
GRAPH_SAVEVECTS ENDP

GRAPH_RESTVECTS PROC FAR
	mov ax, WORD PTR saveEXIT
	mov WORD PTR SYSTEMP_EXITPROC, ax
	mov ax, WORD PTR saveEXIT+2
	mov WORD PTR SYSTEMP_EXITPROC+2, ax
	push ds
	mov dx, WORD PTR save00
	mov ds, WORD PTR save00+2
	mov ax, 2500h
	int 21h
	pop ds
	push ds
	mov dx, WORD PTR save3F
	mov ds, WORD PTR save3F+2
	mov ax, 253Fh
	int 21h
	pop ds
	ret
GRAPH_RESTVECTS ENDP

GRAPHASM_TEXT ENDS

END
